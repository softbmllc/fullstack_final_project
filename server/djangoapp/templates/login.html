{% extends "base.html" %}
{% block title %}Login{% endblock %}
{% block content %}
<h2>Login</h2>

<form id="login-form" style="max-width:420px;margin:20px 0;">
  <div style="margin-bottom:10px">
    <label>Username</label><br/>
    <input id="userName" name="userName" style="width:100%">
  </div>
  <div style="margin-bottom:10px">
    <label>Password</label><br/>
    <input id="password" name="password" type="password" style="width:100%">
  </div>
  <button type="submit">Login</button>
</form>

<script>
document.getElementById('login-form').addEventListener('submit', async (e) => {
  e.preventDefault();
  const userName = document.getElementById('userName').value;
  const password = document.getElementById('password').value;

  const res = await fetch('/djangoapp/login', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({ userName, password })
  });

  const json = await res.json();
  if (json.status === 'Authenticated') {
    sessionStorage.setItem('username', json.userName);
    location.href = '/';
  } else {
    alert('Login failed');
  }
});
</script>
{% endblock %}
